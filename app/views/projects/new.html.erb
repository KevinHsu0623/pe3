<%= render "shared/progress_header" %>

<h1 class="mb-4 fw-bold">建立新專案</h1>

<%= form_with model: @project, local: true, class: "row g-3" do |f| %>
  <div class="col-md-6">
    <%= f.label :project_name, "專案名稱", class: "form-label" %>
    <%= f.text_field :project_name, class: "form-control" %>
  </div>

<div class="col-12">
    <%= f.label :location, "工程位置", class: "form-label" %>
    <%= f.text_field :location, placeholder: "請輸入工程地址", class: "form-control" %>
  </div>

  <div class="col-md-6">
    <%= f.label :project_type, "工程類型", class: "form-label" %>
    <%= f.select :project_type,
      [["建築工程", "建築工程"], ["鋪面工程", "鋪面工程"], ["其他工程", "其他工程"]], {},
      { class: "form-select", id: "project_type_select" } %>
  </div>

  <!-- 建築工程欄位 -->
  <div id="building_fields" style="display: none;">
    <div class="col-md-4">
      <%= f.label :area, "工程面積", class: "form-label" %>
      <%= f.number_field :area, step: 0.01, class: "form-control" %>
    </div>
    <div class="col-md-4">
      <%= f.label :area_unit, "面積單位", class: "form-label" %>
      <%= f.select :area_unit,
        options_for_select([["平方公尺 (m²)", "m2"], ["平方公分 (cm²)", "cm2"], ["平方英尺 (ft²)", "ft2"]], @project.area_unit),
        { prompt: "選擇面積單位" }, class: "form-select" %>
    </div>
    <div class="col-md-4">
      <%= f.label :above_ground_floors, "地上樓層數", class: "form-label" %>
      <%= f.number_field :above_ground_floors, class: "form-control" %>
      <%= f.select :above_floor_unit,
        options_for_select([["層", "floor"], ["米 (m)", "m"], ["公分 (cm)", "cm"], ["英尺 (ft)", "ft"]], @project.above_floor_unit),
        { prompt: "選擇高度單位" }, class: "form-select mt-1" %>
    </div>
    <div class="col-md-4">
      <%= f.label :below_ground_floors, "地下樓層數", class: "form-label" %>
      <%= f.number_field :below_ground_floors, class: "form-control" %>
      <%= f.select :below_floor_unit,
        options_for_select([["層", "floor"], ["米 (m)", "m"], ["公分 (cm)", "cm"], ["英尺 (ft)", "ft"]], @project.below_floor_unit),
        { prompt: "選擇高度單位" }, class: "form-select mt-1" %>
    </div>
  </div>

  <!-- 鋪面工程欄位 -->
  <div id="pavement_fields" style="display: none;">
    <div class="col-md-4">
      <%= f.label :area, "工程面積", class: "form-label" %>
      <%= f.number_field :area, step: 0.01, class: "form-control" %>
    </div>
    <div class="col-md-4">
      <%= f.label :area_unit, "面積單位", class: "form-label" %>
      <%= f.select :area_unit,
        options_for_select([["平方公尺 (m²)", "m2"], ["平方公分 (cm²)", "cm2"], ["平方英尺 (ft²)", "ft2"]], @project.area_unit),
        { prompt: "選擇面積單位" }, class: "form-select" %>
    </div>
    <div class="col-md-4">
      <%= f.label :excavation_depth, "開挖深度", class: "form-label" %>
      <%= f.number_field :excavation_depth, step: 0.01, class: "form-control" %>
      <%= f.select :depth_unit,
        options_for_select([["公尺 (m)", "m"], ["公分 (cm)", "cm"], ["英尺 (ft)", "ft"]], @project.depth_unit),
        { prompt: "選擇深度單位" }, class: "form-select mt-1" %>
    </div>
  </div>

  <div class="col-12">
    <%= f.submit "建立專案", class: "btn btn-primary mt-3" %>
  </div>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const projectTypeSelect = document.getElementById("project_type_select")
    const buildingFields = document.getElementById("building_fields")
    const pavementFields = document.getElementById("pavement_fields")

    function toggleFields() {
      const selected = projectTypeSelect.value
      buildingFields.style.display = "none"
      pavementFields.style.display = "none"

      if (selected === "建築工程") {
        buildingFields.style.display = "flex"
      } else if (selected === "鋪面工程") {
        pavementFields.style.display = "flex"
      }
    }

    toggleFields()
    projectTypeSelect.addEventListener("change", toggleFields)
  });
</script>
